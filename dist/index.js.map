{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Bot, Context, session, SessionFlavor } from \"grammy\";\nimport {\n  AgentKit,\n  cdpApiActionProvider,\n  cdpSmartWalletActionProvider,\n  erc20ActionProvider,\n  pythActionProvider,\n  CdpSmartWalletProvider,\n  walletActionProvider,\n  wethActionProvider,\n} from \"@coinbase/agentkit\";\nimport \"dotenv/config\";\n\n// Session data for tracking user state\ninterface SessionData {\n  messageCount: number;\n}\n\ntype MyContext = Context & SessionFlavor<SessionData>;\n\nlet agentKit: AgentKit | null = null;\n\nasync function initializeAgentKit(): Promise<AgentKit> {\n  if (agentKit) return agentKit;\n\n  const walletProvider = await CdpSmartWalletProvider.configureWithWallet({\n    apiKeyId: process.env.CDP_API_KEY_ID!,\n    apiKeySecret: process.env.CDP_API_KEY_SECRET!,\n    walletSecret: process.env.CDP_WALLET_SECRET!,\n    networkId: (process.env.NETWORK_ID || \"base-mainnet\") as any,\n  });\n\n  agentKit = await AgentKit.from({\n    walletProvider,\n    actionProviders: [\n      walletActionProvider(),\n      erc20ActionProvider(),\n      wethActionProvider(),\n      pythActionProvider(),\n      cdpApiActionProvider(),\n      cdpSmartWalletActionProvider(),\n    ],\n  });\n\n  return agentKit;\n}\n\n// Find and execute an AgentKit action by name\nasync function executeAction(\n  agent: AgentKit,\n  actionName: string,\n  args: Record<string, any> = {}\n): Promise<string> {\n  const actions = agent.getActions();\n  const action = actions.find((a) => a.name === actionName);\n  if (!action) {\n    return `Action \"${actionName}\" not found.`;\n  }\n  try {\n    const result = await action.invoke(args);\n    return typeof result === \"string\" ? result : JSON.stringify(result, null, 2);\n  } catch (error: any) {\n    return `Error executing ${actionName}: ${error.message}`;\n  }\n}\n\n// Process user message and route to the right action\nasync function processMessage(\n  agent: AgentKit,\n  text: string\n): Promise<string> {\n  const lower = text.toLowerCase().trim();\n\n  // Wallet details\n  if (\n    lower.includes(\"wallet\") ||\n    lower.includes(\"address\") ||\n    lower.includes(\"balance\")\n  ) {\n    return executeAction(agent, \"WalletActionProvider_get_wallet_details\");\n  }\n\n  // ETH balance\n  if (lower.includes(\"eth balance\") || lower === \"balance\") {\n    return executeAction(agent, \"WalletActionProvider_get_balance\");\n  }\n\n  // Token price\n  if (lower.includes(\"price\")) {\n    // Extract token symbol\n    const tokens: Record<string, string> = {\n      eth: \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n      btc: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n      usdc: \"0xeaa020c61cc479712813461ce153894a96a6c00b21ed0cfc2798d1f9a9e9c94a\",\n      sol: \"0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d\",\n    };\n\n    let tokenId = tokens[\"eth\"]; // default\n    let tokenName = \"ETH\";\n    for (const [name, id] of Object.entries(tokens)) {\n      if (lower.includes(name)) {\n        tokenId = id;\n        tokenName = name.toUpperCase();\n        break;\n      }\n    }\n\n    return executeAction(agent, \"PythActionProvider_fetch_price\", {\n      priceFeedID: tokenId,\n    });\n  }\n\n  // Wrap ETH\n  if (lower.includes(\"wrap\")) {\n    const amountMatch = lower.match(/(\\d+\\.?\\d*)/);\n    const amount = amountMatch ? amountMatch[1] : \"0.001\";\n    return executeAction(agent, \"WethActionProvider_wrap_eth\", {\n      amountToWrap: amount,\n    });\n  }\n\n  // Transfer\n  if (lower.includes(\"transfer\") || lower.includes(\"send\")) {\n    return \"‚ö†Ô∏è To transfer tokens, use this format:\\n\\n`/transfer <amount> <token> to <address>`\\n\\nExample: `/transfer 0.01 ETH to 0x1234...`\";\n  }\n\n  // List actions\n  if (\n    lower.includes(\"help\") ||\n    lower.includes(\"command\") ||\n    lower.includes(\"action\") ||\n    lower.includes(\"what can\")\n  ) {\n    const actions = agent.getActions();\n    const list = actions.map((a) => `‚Ä¢ \\`${a.name}\\``).join(\"\\n\");\n    return `ü§ñ *Available Blockchain Operations:*\\n\\n${list}\\n\\n*Quick Commands:*\\n/wallet ‚Äî Wallet details\\n/balance ‚Äî ETH balance\\n/price ‚Äî ETH price\\n/price btc ‚Äî BTC price\\n/actions ‚Äî List all actions`;\n  }\n\n  // Default\n  return `ü§ñ *Blockchain Agent*\\n\\nI can help you with:\\n\\n‚Ä¢ /wallet ‚Äî View wallet details\\n‚Ä¢ /balance ‚Äî Check ETH balance\\n‚Ä¢ /price ‚Äî Get token prices\\n‚Ä¢ /price btc ‚Äî BTC price\\n‚Ä¢ /price sol ‚Äî SOL price\\n‚Ä¢ /wrap <amount> ‚Äî Wrap ETH to WETH\\n‚Ä¢ /actions ‚Äî List all available actions\\n\\nJust type a command or ask me anything!`;\n}\n\nasync function main() {\n  if (!process.env.TELEGRAM_BOT_TOKEN) {\n    console.error(\"‚ùå TELEGRAM_BOT_TOKEN is required in .env\");\n    console.log(\"\\nTo get a bot token:\");\n    console.log(\"1. Open Telegram and search for @BotFather\");\n    console.log(\"2. Send /newbot\");\n    console.log(\"3. Follow the prompts to name your bot\");\n    console.log(\"4. Copy the token and paste it in .env\");\n    process.exit(1);\n  }\n\n  console.log(\"üîß Initializing AgentKit...\");\n  const agent = await initializeAgentKit();\n  console.log(\"‚úÖ AgentKit initialized on Base Mainnet\");\n\n  const bot = new Bot<MyContext>(process.env.TELEGRAM_BOT_TOKEN);\n\n  // Session middleware\n  bot.use(\n    session({\n      initial: (): SessionData => ({ messageCount: 0 }),\n    })\n  );\n\n  // /start command\n  bot.command(\"start\", async (ctx) => {\n    await ctx.reply(\n      \"üöÄ *Welcome to the Blockchain Agent!*\\n\\n\" +\n        \"I'm your AI-powered blockchain assistant on *Base Mainnet*.\\n\\n\" +\n        \"Here's what I can do:\\n\" +\n        \"‚Ä¢ /wallet ‚Äî View wallet address & details\\n\" +\n        \"‚Ä¢ /balance ‚Äî Check ETH balance\\n\" +\n        \"‚Ä¢ /price ‚Äî Get ETH price\\n\" +\n        \"‚Ä¢ /price btc ‚Äî Get BTC price\\n\" +\n        \"‚Ä¢ /wrap <amount> ‚Äî Wrap ETH to WETH\\n\" +\n        \"‚Ä¢ /actions ‚Äî List all blockchain operations\\n\\n\" +\n        \"Just type a command or ask me anything!\",\n      { parse_mode: \"Markdown\" }\n    );\n  });\n\n  // /wallet command\n  bot.command(\"wallet\", async (ctx) => {\n    await ctx.reply(\"üîç Fetching wallet details...\");\n    const result = await executeAction(\n      agent,\n      \"WalletActionProvider_get_wallet_details\"\n    );\n    await ctx.reply(`üíº *Wallet Details:*\\n\\n${result}`, {\n      parse_mode: \"Markdown\",\n    });\n  });\n\n  // /balance command\n  bot.command(\"balance\", async (ctx) => {\n    await ctx.reply(\"üîç Checking balance...\");\n    const result = await executeAction(\n      agent,\n      \"WalletActionProvider_get_wallet_details\"\n    );\n    await ctx.reply(`üí∞ *Balance:*\\n\\n${result}`, {\n      parse_mode: \"Markdown\",\n    });\n  });\n\n  // /price command\n  bot.command(\"price\", async (ctx) => {\n    const text = ctx.message?.text || \"\";\n    await ctx.reply(\"üìä Fetching price...\");\n    const result = await processMessage(agent, text);\n    await ctx.reply(result, { parse_mode: \"Markdown\" });\n  });\n\n  // /actions command\n  bot.command(\"actions\", async (ctx) => {\n    const actions = agent.getActions();\n    const list = actions.map((a) => `‚Ä¢ \\`${a.name}\\``).join(\"\\n\");\n    await ctx.reply(\n      `ü§ñ *Available Blockchain Operations (${actions.length}):*\\n\\n${list}`,\n      { parse_mode: \"Markdown\" }\n    );\n  });\n\n  // /wrap command\n  bot.command(\"wrap\", async (ctx) => {\n    const text = ctx.message?.text || \"\";\n    const amountMatch = text.match(/(\\d+\\.?\\d*)/);\n    const amount = amountMatch ? amountMatch[1] : \"0.001\";\n    await ctx.reply(`üîÑ Wrapping ${amount} ETH to WETH...`);\n    const result = await executeAction(agent, \"WethActionProvider_wrap_eth\", {\n      amountToWrap: amount,\n    });\n    await ctx.reply(`‚úÖ *Wrap Result:*\\n\\n${result}`, {\n      parse_mode: \"Markdown\",\n    });\n  });\n\n  // Handle all other text messages\n  bot.on(\"message:text\", async (ctx) => {\n    const text = ctx.message.text;\n    await ctx.reply(\"‚è≥ Processing...\");\n    const result = await processMessage(agent, text);\n    await ctx.reply(result, { parse_mode: \"Markdown\" });\n  });\n\n  // Error handler\n  bot.catch((err) => {\n    console.error(\"Bot error:\", err);\n  });\n\n  // Start the bot\n  console.log(\"ü§ñ Telegram bot starting...\");\n  await bot.start({\n    onStart: () => {\n      console.log(\"‚úÖ Bot is running! Send /start in Telegram to begin.\");\n    },\n  });\n}\n\nmain().catch(console.error);\n"],"mappings":"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","names":[]}